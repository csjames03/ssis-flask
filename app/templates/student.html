{% extends 'layout.html'%}
{%block title %}
    SSIS-Students
{% endblock %}


{% block content %}
    <div class="add-student-button" id="show-modal">
        Add Student
    </div>
    <div class="add-student-modal">
        <form action="" method="post" id="form">
            <div class="form-row">
                <img src="{{ url_for('static', filename='images/Zeus.jpg') }}" alt="Avatar" width="100" height="100">
            </div>
            <div class="form-row">
                <input type="text" name="id" id="inpt-id" placeholder="Enter student's id number">
            </div> 
            <div class="form-row">
                <input type="text" name="fname" id="inpt-fname" placeholder="Enter student's firstname">
                <input type="text" name="lname" id="inpt-lname" placeholder="Enter student's lastname">
            </div> 
            <div class="form-row">
                <input type="text" name="mname" id="inpt-mname" placeholder="Enter student's middlename" >
                <input type="email" name="email" id="inpt-email" placeholder="Enter student's email address">
            </div>
            <div class="form-row">
                <select name="sex" id="inpt-sex">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
                <input type="date" name="date" id="inpt-date">
            </div>
            <div class="form-row">
                <select name="course" id="inpt-course">
                    <option value="1">Computer Science</option>
                    <option value="2">Information Technology</option>
                    <option value="3">Computer Applications</option>
                    <option value="4">Information System</option>
                </select>
                <select name="year" id="inpt-year">
                    <option value="1">1st</option>
                    <option value="2">2nd</option>
                    <option value="3">3rd</option>
                    <option value="4">4th</option>
                </select>
            </div>
            <div class="form-row">
                <button type="submit" class="submit-form">Submit</button>
                <div class="cancel-form" id="cancel-form">Cancel</div>
            </div>
        </form>
    </div>
    <div class="content">
    <div class="scroll-container">
        <div class="scroll-table">
            <div class="scroll-row head">
                <div class="scroll-cell">Student ID</div>
                <div class="scroll-cell">Fullname</div>
                <div class="scroll-cell">Sex</div>
                <div class="scroll-cell">Age</div>
                <div class="scroll-cell">Year</div>
                <div class="scroll-cell">Course_Code</div>
                <div class="scroll-cell">Edit</div>
                <div class="scroll-cell">Delete</div>
            </div>
        </div>
    </div>
        <div class="scroll-container">
            <div class="scroll-table">
               <div class="scroll-row">
                {% for student in students %}
                    <div class="scroll-cell">{{student.id}}</div>
                    <div class="scroll-cell">{{student.fname}} {{student.lname}}</div>
                    <div class="scroll-cell">{{student.gender}}</div>
                    <div class="scroll-cell">{{student.birthdate}}</div>
                    <div class="scroll-cell">{{student.year}}</div>
                    <div class="scroll-cell">{{student.course_code}}</div>
                    <div class="scroll-cell">Edit</div>
                    <div class="scroll-cell">Delete</div>
                 {% endfor %}
               </div>
               <!-- Add more rows as needed -->
            </div>
           </div>
        <div class="message" id="s-alert-mssg">
            <p class="success-message" id="success-alt-message">
                a,sjdhjkasdh
            </p>
        </div>
        <div class="err-message" id="e-alert-mssg">
            <p class="success-message">
                a,sjdhjkasdh
            </p>
        </div>
    </div>
{% endblock %}

{% block script %}
<script>
    const showModalButton = document.querySelector('#show-modal');
    const addStudentModal = document.querySelector('.add-student-modal')
    showModalButton.addEventListener('click',() =>{
        showModalButton.classList.remove('addStudentButtonIn')
        addStudentModal.classList.add('addStudentModalIn')
        addStudentModal.classList.remove('addStudentModalOut')
        showModalButton.classList.add('addStudentButtonOut')    
        document.querySelector('#nav').style.paddingRight = '50px'
    })
    
    document.addEventListener('click', function(event) {
        if ((event.target !== addStudentModal && event.target !== showModalButton  
        && hasClass(addStudentModal, 'addStudentModalIn') && !addStudentModal.contains(event.target))||event.target == document.querySelector('#cancel-form')) {
            Hide()
        }
    });

    function hasClass(element, className) {
    return element.classList.contains(className);
    }

    function Hide(){
            addStudentModal.classList.remove('addStudentModalIn')
            showModalButton.classList.remove('addStudentButtonOut')
            addStudentModal.classList.add('addStudentModalOut')
            showModalButton.classList.add('addStudentButtonIn')
            document.querySelector('#nav').style.paddingRight = '400px'
    }
    document.querySelector('#form').addEventListener('submit', function(event) {
        event.preventDefault();
        Submit()
    })

    async function Submit() {
    const id = document.querySelector('#inpt-id').value;
    const fname = document.querySelector('#inpt-fname').value;
    const mname = document.querySelector('#inpt-mname').value;
    const lname = document.querySelector('#inpt-lname').value;
    const date = document.querySelector('#inpt-date').value;
    const sex = document.querySelector('#inpt-sex').value;
    const email = document.querySelector('#inpt-email').value;
    const course = document.querySelector('#inpt-course').value;
    const year = document.querySelector('#inpt-year').value;
    
    const url = window.origin + '/addstudent';
    const data = {
        id: id,
        fname: fname,
        mname: mname,
        lname: lname,
        date: date,
        sex: sex,
        email: email,
        course: course,
        year: year,
    };
    
    const response = await fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
    });

    if (response.ok) {
        const res = await response.json();
        console.log(res);
        Hide()
        document.querySelector('#success-alt-message').innerHTML = res.message;
        document.getElementById('s-alert-mssg').classList.add('messageIn')
        setTimeout(function(){
            document.getElementById('s-alert-mssg').classList.remove('messageIn')
            document.getElementById('s-alert-mssg').classList.add('messageOut')
            setTimeout(function(){
                document.getElementById('s-alert-mssg').classList.remove('messageOut')
            },1000)
        }, 2500)
    } else {
        document.getElementById('e-alert-mssg').classList.add('messageIn')
        addStudentModal.style.boxShadow = '5px 5px 40px 10px #e8175d'
        setTimeout(function(){
            document.getElementById('e-alert-mssg').classList.remove('messageIn')
            addStudentModal.classList.remove('Nahhhhhh')
            document.getElementById('e-alert-mssg').classList.add('messageOut')
            addStudentModal.style.boxShadow = '5px 5px 40px 10px #363636'
            setTimeout(function(){
                document.getElementById('e-alert-mssg').classList.remove('messageOut')
            },1000)
        }, 2500)
        console.error('Request failed with status: ' + response.status);
    }
}


function errorForm(){

}






</script>
{% endblock%}